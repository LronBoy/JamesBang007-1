<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Page Title</title>
<meta name="keywords" content="">
<meta name="description" content="">
<script type="text/javascript">
function rem() {
    var html = document.documentElement;
    var hWidth = html.getBoundingClientRect().width;
    hWidth = hWidth > 750 ? 750 : hWidth;
    html.style.fontSize = hWidth / 15 + "px";
}
(function() {
    rem();
})();
window.onresize = rem;
</script>
</head>
<body>
<style type="text/css">
* {
    margin: 0;
    padding: 0;
}

video {
    min-width: 320px;
    min-height: 200px;
    max-width: 100%;
    max-height: 100%;
    background-color: #333;
}
</style>

<!-- <script src="../js/flv.min.js"></script>
<video id="videoElement"></video>
<script>
if (flvjs.isSupported()) {
    var videoElement = document.getElementById('videoElement');
    var flvPlayer = flvjs.createPlayer({
        type: 'mp4',
        url: 'http://qiufa-app-video.oss-cn-beijing.aliyuncs.com/201911/15/5dce3cbbc8040.mp4'
    });
    flvPlayer.attachMediaElement(videoElement);
    flvPlayer.load();
    setTimeout(function() {
        flvPlayer.play();
    }, 200);
}
</script> -->



<style type="text/css">
body {
    margin: 0 auto;
    max-width: 750px;
    background-color: #1f2c3b;
}

.note-video-container {
    position: relative;
    width: 100%;
    height: 100vh;
}

.video-box {
    position: relative;
    top: 0;
    left: 0;
    height: 100%;
    overflow: hidden;
}

.video-box .video-poster,
.video-box video {
    position: absolute;
    top: 50%;
    left: 50%;
    display: block;
    width: 100%;
    height: auto;
    transform: translate3d(-50%, -50%, 0);
}

.video-box .views {
    position: absolute;
    left: .3rem;
    bottom: .3rem;
    padding: .1rem .2rem;
    border-radius: .26rem;
    font-size: .26rem;
    line-height: .3rem;
    color: #fff;
    background-color: rgba(51, 51, 51, .7);
}

.video-box .loading-icon-box,
.video-box .poster-play-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 1.28rem;
    height: 1.28rem;
    transform: translate3d(-50%, -50%, 0);
}

</style>

<div class="note-video-container" id="app">
    <div class="video-box">
        <video id="videoPlayer" src="http://qiufa-app-video.oss-cn-beijing.aliyuncs.com/201911/15/5dce3cbbc8040.mp4" poster="http://qiufa-app-video.oss-cn-beijing.aliyuncs.com/201911/15/5dce3cbbc8040.mp4?x-oss-process=video/snapshot,t_1000,f_jpg"
            preload="metadata" webkit-playsinline="true" playsinline="true" x5-video-player-type="h5" x5-video-player-fullscreen="true" style="_display: none;"
            controls="controls">
            您的浏览器不支持 video 标签
        </video>
        <div class="video-mask">            
            <img src="https://qiufa-app.oss-cn-beijing.aliyuncs.com/web/pic.jpg?x-oss-process=image/resize,m_fill,w_540,h_540" class="video-poster" id="videoPalse"
                v-show="!video.playing">
            <div class="views" v-show="!video.playing">116.2万次播放</div>
            <img src="//s.xiaohongshu.com/formula-static/puar/public/img/play-icon.54fa333.png" class="poster-play-icon" v-show="!video.playing">
            <div class="loading-icon-box" style="display: none;">
                <img src="" class="loading-icon">
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script type="text/javascript">
new Vue({
    el: "#app",
    data: {
        msg: "6666666",
        video: {
            pic: 'https://qiufa-app.oss-cn-beijing.aliyuncs.com/web/pic.jpg',
            // url: '../_bak/video.mp4',
            url: 'https://qiufa-app.oss-cn-beijing.aliyuncs.com/web/video.mp4',
            playing: false,
            is_controls: true, //是否显示播放控件
        },
    },
    methods: {
        tapVideo: function() {
            console.log('tapVideotapVideo')
            let that = this;
            if (that.video.playing) {
                that.video.playing = false;
                console.log('暂停当前播放视频');
                // player.pause() //暂停当前播放的视频
            } else {
                that.video.playing = true;
                console.log('播放视频');
            }
        },
        playerVideo: function() {
            let that = this;
            let player = document.querySelector("#videoPlayer"); //播放器的元素

            if (that.video.playing) {
                that.video.playing = false
                console.log('暂停当前播放视频')
                player.pause() //暂停当前播放的视频
            } else {
                clearInterval(timer1)
                clearInterval(timer2)

                // autoplay     设置或返回是否在加载完成后随即播放音频/视频
                // muted        设置或返回音频/视频是否静音。
                // paused       设置或返回音频/视频是否暂停
                // preload      设置或返回音频/视频是否应该在页面加载后进行加载。
                // readyState   返回音频/视频当前的就绪状态      
                // play()	    开始播放音频/视频
                // pause()      暂停当前播放的音频/视频

                //开始播放
                timer1 = setInterval(function() {
                    if (player.readyState == 4) { //可用数据足以开始播放
                        clearInterval(timer1)
                        console.log('播放视频')
                        player.play()
                        that.video.playing = true
                    }
                }, 50);

                //监听播放状态
                timer2 = setInterval(function() {
                    if (player.paused) {
                        clearInterval(timer2)
                        console.log("视频已暂停播放")
                        that.video.playing = false
                    } else {
                        console.log("视频没有暂停，播放中")
                        that.video.is_controls = false
                    }
                }, 1000);
            }
        },
    }
})

//iPhone判断
function isInIos() {
    var userAgentInfo = navigator.userAgent,
        Agents = ["iPhone", "iPad", "iPod"];
    for (var v = 0; v < Agents.length; v++) {
        if (userAgentInfo.indexOf(Agents[v]) > 0) {
            return true;
        }
    }
    return false;
}

//点击屏幕的时候暂停，并且图片隐藏，再次点击视频或者图片的时候播放
let videoplay = document.getElementById("videoPlayer");
if (videoplay) {
    //点击图片的时候暂停，并且使图片隐藏，再次点击视频或者图片的时候播放
    videoplay.onclick = function() {
        if (videoplay.paused) {
            videoplay.play();
            videoPalse.style.display = "none"; //播放的时候图标隐藏
        } else {
            videoplay.pause();
            videoPalse.style.display = "block"; //暂停的时候图标显示
        }
    };
    //对于ios系统播放完毕之后变黑的情况,在播放结束的时候所以要重新刷新一下src
    if (isInIos) {
        //isiOS是我设置的变量判断ios系统的常量，如果需要判断条件可以评论或者私信我
        videoplay.addEventListener('ended', function(e) {
            // 播放结束时触发的时候使播放图标显示，同时播放完之后重新加载video的src
            videoPalse.style.display = "block";
            videoplay.src = require("https://qiufa-app.oss-cn-beijing.aliyuncs.com/web/video.mp4");
        })
    }

}
//同样点击图标的时候也需要播放暂停，下面是对图标的处理
let videoPalse = document.getElementById("videoPalse"); //video标签
if (videoPalse) {
    videoPalse.onclick = function() {
        console.log("点击图标")
        if (videoplay.paused) { //点击视频的时候如果暂停状态，则让其播放
            videoplay.play();
            videoPalse.style.display = "none";
        } else {
            videoplay.pause();
            videoPalse.style.display = "block";
        }
    };
}
</script>

</body>
</html>
