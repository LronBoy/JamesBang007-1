<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
<title>瀑布流</title>
<meta name="keywords" content="">
<meta name="description" content="">
<link rel="stylesheet" href="../css/1803.css" />
<style type="text/css">
body {
    max-width: 100%;
}

#container {
    margin: 0 auto;
    padding: 10px;
    max-width: 100%;
    min-height: 600px;
    background: #fff;
}

.img-list {
    position: relative;
}

.img-list .img-item {
    /*float: left;
    margin: 5px 5px 0 0;*/
    position: absolute;
    width: 288px;
    list-style: none;
    line-height: 1.6;
    font-size: 14px;
    overflow: hidden;
}

.img-list img {
    width: 100%;
    vertical-align: middle;
}
</style>
</head>
<body>

<div id="container">
    <ul class="img-list">
    </ul>
</div>

<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script type="text/javascript">
/*
 * 瀑布流
 *
 */

var $container = $("#container");
var iCell = 0,
    iWidth = 280,
    iSpeace = 10,
    itemWidth = iWidth + iSpeace,
    arrT = [],
    arrL = [],
    iPage = 0;

//计算列数
function setCell() {
    iCell = Math.floor($(window).innerWidth() / itemWidth);
    if(iCell>10){
        iCell = 10;
    }
    if(iCell<5){
        iCell = 5;
    }
    console.log("iCell:" + iCell);
    $container.css("width", iCell * itemWidth + 10);
    //定位值，数组
    arrT = [];
    arrL = [];
    for(var i = 0; i < iCell; i++) {
        arrT[i] = 0;
        arrL[i] = itemWidth * i;
    }
}
setCell();

$.ajax({
    type: "GET",
    url: "https://image.baidu.com/search/acjson",
    data: {
        tn: "resultjson_com",
        ipn: "rj",
        fp: "result",
        word: "巴厘岛",
        pn: 0,
        rn: 100
    },
    dataType: 'jsonp',
    jsonpCallback: "addCon",
    success: function(res) {
        //console.log(res.data);
    },
    error: function(err) {
        console.log('请求失败：');
    },
    complete: function() {}
})

function addCon(res) {
    $.each(res.data, function(i, item) {
        if(!item.thumbURL) return;
        var $item = $('<li class="img-item"></li>').appendTo(".img-list");
        var $img = $('<img>')
        //设置图片元素
        $img.attr("src", item.thumbURL);
        $img.css({
            width: iWidth + "px",
            height: Math.round(item.height / item.width * iWidth) + 10 + "px"
        });
        $img.appendTo($item);

        //设置绝对定位值
        var _i = getMinIndex();
        $item.css({
            left: arrL[_i],
            top: arrT[_i]
        })
        var _h = $item.height() || $img.height();
        arrT[_i] += _h + 10;
        $(".img-list").height(getMax() + "px");

        console.log($item);
        console.log($item.height(), $img.height());
    });

}

function getMinIndex() {
    var v = arrT[0];
    var _index = 0;

    for(var i = 1; i < arrT.length; i++) {
        if(arrT[i] < v) {
            v = arrT[i];
            _index = i;
        }
    }
    return _index;
}

function getMax() {
    var v = arrT[0];

    for(var i = 1; i < arrT.length; i++) {
        if(arrT[i] > v) {
            v = arrT[i];
        }
    }
    return v;
}

$(window).on("resize", function() {
    setCell();
    $container.find('li').each(function() {
        var _index = getMinIndex();
        $(this).animate({
            left: arrL[_index],
            top: arrT[_index]
        }, 500);
        arrT[_index] += $(this).height() + 10;
    });

})
</script>
</body>
</html>